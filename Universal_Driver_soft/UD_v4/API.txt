# Описание API-команд контроллера двигателя

Контроллер поддерживает множество команд, которые следуют общему формату:
`C<номер_команды>A<адрес>D<данные>N<данные1>x`

## Таблица API-команд

| № | Название | Адрес | Данные | Данные1 | Функция | Ответ | Пример команды |
|---|----------|-------|--------|---------|---------|-------|---------------|
| 1 | Старт/Стоп | 0 | 0 | - | Остановка двигателя | "OK" | `C1A0D0N0x` |
| 1 | Старт/Стоп | 0 | 1 | - | Запуск двигателя в соответствии с заданными параметрами | "OK" или "noStart" при ошибке | `C1A0D1N0x` |
| 1 | Старт/Стоп | 0 | 2 | - | Остановка двигателя (альтернативный способ) | "OK" | `C1A0D2N0x` |
| 1 | Старт/Стоп | 0 | 3 | - | Движение к концевому выключателю 0 | "OK" или "not calibrated" если не выполнена калибровка | `C1A0D3N0x` |
| 1 | Старт/Стоп | 1 | - | - | Получение статуса вращения двигателя | Числовое значение статуса | `C1A1D0N0x` |
| 2 | Калибровка | - | - | - | Запуск процесса калибровки (проезд между концевиками) | "Start call" | `C2A0D0N0x` |
| 3 | Скорость | 0 | процент | процент_старта | Установка скорости вращения (1-1000) и начальной скорости | "OK" | `C3A0D500N200x` |
| 3 | Скорость | 1 | - | - | Получение текущей скорости двигателя | Числовое значение скорости (1-1000) | `C3A1D0N0x` |
| 4 | Целевая позиция | 0 | шаги | - | Установка целевой позиции в шагах | Код ошибки + "OK" | `C4A0D1000N0x` |
| 4 | Целевая позиция | 1 | - | - | Получение текущей целевой позиции | Числовое значение позиции | `C4A1D0N0x` |
| 5 | Статус цели | 0 | - | - | Получение статуса выполнения движения к цели | Числовое значение статуса | `C5A0D0N0x` |
| 5 | Статус цели | 1 | - | - | Получение текущего положения относительно концевых выключателей | Значение положения | `C5A1D0N0x` |
| 5 | Статус цели | 2 | - | - | Получение количества пройденных шагов при последнем движении | Количество шагов | `C5A2D0N0x` |
| 5 | Статус цели | 3 | - | - | Получение статуса драйвера двигателя | Статус драйвера (0=ОК, 1=Ошибка) | `C5A3D0N0x` |
| 6 | Ускорение | 0 | значение | - | Установка параметра ускорения | "OK" | `C6A0D10N0x` |
| 6 | Ускорение | 1 | - | - | Получение текущего значения ускорения | Значение ускорения | `C6A1D0N0x` |
| 6 | Ускорение | 2 | значение | - | Установка параметра замедления | "OK" | `C6A2D10N0x` |
| 6 | Ускорение | 3 | - | - | Получение текущего значения замедления | Значение замедления | `C6A3D0N0x` |
| 7 | Расстояние торможения | 0 | дистанция | - | Установка дистанции начала торможения в шагах | "OK" | `C7A0D100N0x` |
| 7 | Расстояние торможения | 1 | - | - | Получение текущей дистанции торможения | Значение дистанции | `C7A1D0N0x` |
| 8 | Направление | 0 | 0/1 | - | Установка направления вращения (0=по часовой, 1=против часовой) | "OK" или "motor not stopped" если двигатель работает | `C8A0D1N0x` |
| 8 | Направление | 1 | - | - | Получение текущего направления вращения | Значение направления (0/1) | `C8A1D0N0x` |
| 9 | Режим вращения | 0 | режим | - | Установка режима вращения (значения 0-8) | "OK" | `C9A0D3N0x` |
| 9 | Режим вращения | 1 | - | - | Получение текущего режима вращения | Значение режима | `C9A1D0N0x` |
| 9 | Режим вращения | 2 | тип_мотора | - | Установка типа двигателя (0=шаговый, 1=BLDC) | "OK" | `C9A2D0N0x` |
| 9 | Режим вращения | 3 | - | - | Получение текущего типа двигателя | Значение типа (0/1) | `C9A3D0N0x` |
| 10 | Тайм-аут | 0 | время | - | Установка тайм-аута в мс для операций движения | "OK" | `C10A0D5000N0x` |
| 10 | Тайм-аут | 1 | - | - | Получение текущего значения тайм-аута | Значение тайм-аута в мс | `C10A1D0N0x` |
| 11 | Сохранение | - | - | - | Сохранение настроек во флэш-память | "OK" | `C11A0D0N0x` |
| 12 | Перезагрузка | 1 | - | - | Перезагрузка контроллера | "OK" | `C12A0D1N0x` |
| 13 | DHCP | - | 0/1 | - | Включение (1) или отключение (0) DHCP | "OK" | `C13A0D1N0x` |
| 14 | IP | 0-3 | значение | - | Установка октета IP-адреса (0-3) | "OK" | `C14A0D192N0x` |
| 15 | Маска подсети | 0-3 | значение | - | Установка октета маски подсети (0-3) | "OK" | `C15A0D255N0x` |
| 16 | Шлюз | 0-3 | значение | - | Установка октета IP-адреса шлюза (0-3) | "OK" | `C16A0D192N0x` |
| 17 | MAC | 0-5 | значение | - | Установка байта MAC-адреса (0-5) | "OK" | `C17A0D18N0x` |
| 20 | Сохранение точки | 0 | номер_точки | - | Сохранение текущей позиции как точки (0-9) | "OK" или "Error saving point" | `C20A0D2N0x` |
| 21 | Получение позиции | 1 | - | - | Получение текущего количества шагов | Значение шагов | `C21A1D0N0x` |
| 21 | Получение позиции | 2 | - | - | Получение номера текущей точки | Номер точки (0-9) | `C21A2D0N0x` |
| 21 | Получение позиции | 3 | - | - | Получение статуса калибровки | 1 (калиброван) или 0 (не калиброван) | `C21A3D0N0x` |
| 22 | Переход к SW0 | - | - | - | Движение к концевому выключателю 0 | "OK" или "Error moving to sw0" | `C22A0D0N0x` |
| 23 | Переход к SW1 | - | - | - | Движение к концевому выключателю 1 | "OK" или "Error moving to sw1" | `C23A0D0N0x` |
| 24 | Переход к точке | 0 | номер_точки | - | Движение к сохраненной точке (0-9) | "OK" или "Error moving to point" | `C24A0D3N0x` |
| 25 | Получение точки | 1 | номер_точки | - | Получение позиции для номера точки (0-9) | Значение позиции или "Error number point" | `C25A1D2N0x` |
| 27 | Переход к позиции | 0 | позиция | - | Движение к абсолютной позиции в шагах | "OK" или "Error moving to position" | `C27A0D5000N0x` |
| 28 | Получение максимальной позиции | 1 | - | - | Получение максимальной позиции системы | Значение максимальной позиции | `C28A1D0N0x` |
| 29 | Получение минимальной позиции | 1 | - | - | Получение минимальной позиции системы | Значение минимальной позиции | `C29A1D0N0x` |
| 30 | Установка точки | 0 | номер_точки | позиция | Установка точки на конкретную позицию | "OK" | `C30A0D1N1000x` |

## Подробное описание режимов вращения (для команды 9, адрес 0)

| Значение | Режим | Описание |
|----------|-------|----------|
| 0 | bldc_inf | Режим бесконечного вращения для BLDC-двигателя |
| 1 | bldc_limit | Режим вращения BLDC-двигателя с остановкой по концевым выключателям |
| 2 | step_inf | Режим бесконечного вращения шагового двигателя с использованием таймера |
| 3 | step_by_meter_timer_limit | Режим движения шагового двигателя с таймером, ограниченный концевыми выключателями |
| 4 | step_by_meter_enc_limit | Режим движения шагового двигателя с энкодером, ограниченный концевыми выключателями |
| 5 | step_by_meter_timer_intermediate | Режим движения с промежуточными остановками по таймеру |
| 6 | step_by_meter_enc_intermediate | Режим движения с промежуточными остановками по энкодеру |
| 7 | calibration_timer | Режим калибровки с использованием таймера |
| 8 | calibration_enc | Режим калибровки с использованием энкодера |

## Коды статусов движения (для команды 1, адрес 1)

| Значение | Статус | Описание |
|----------|--------|----------|
| 0 | MOTION | Равномерное движение |
| 1 | STOPPED | Двигатель остановлен |
| 2 | ACCEL | Этап ускорения |
| 3 | BRAKING | Этап торможения |
| 4 | ERROR_M | Ошибка двигателя |

## Статусы цели (для команды 5, адрес 0)

| Значение | Статус | Описание |
|----------|--------|----------|
| 0 | inProgress | Движение к цели выполняется |
| 1 | finished | Движение к цели успешно завершено |
| 2 | errMotion | Ошибка движения (например, тайм-аут) |
| 3 | errDirection | Ошибка направления (обнаружено при контроле энкодера) |
| 4 | errDriver | Ошибка драйвера двигателя |

## Типичные сценарии использования

### Калибровка системы
1. Запуск калибровки: `C2A0D0N0x` (команда 2)
2. Проверка завершения калибровки: `C21A3D0N0x` (должен быть ответ с значением 1)

### Настройка и движение к позиции
1. Установка параметров ускорения: `C6A0D10N0x`
2. Установка параметров замедления: `C6A2D5N0x`
3. Установка дистанции начала торможения: `C7A0D200N0x`
4. Установка скорости: `C3A0D500N200x` (скорость 500, начальная скорость 200)
5. Движение к абсолютной позиции: `C27A0D1000N0x` (движение к позиции 1000 шагов)

### Работа с точками
1. Движение к концевому выключателю 0: `C22A0D0N0x`
2. Сохранение текущей позиции как точки 0: `C20A0D0N0x`
3. Движение к другой позиции: `C27A0D500N0x`
4. Сохранение как точки 1: `C20A0D1N0x`
5. Возврат к точке 0: `C24A0D0N0x`

### Получение статуса системы
1. Получение текущего положения: `C21A1D0N0x`
2. Получение статуса двигателя: `C1A1D0N0x`
3. Получение статуса выполнения движения: `C5A0D0N0x`
4. Получение статуса драйвера: `C5A3D0N0x`

## Примечания
- Перед использованием команд позиционирования система должна быть откалибрована с помощью команды 2 (калибровка).
- Драйвер проверяет свой статус перед выполнением команд и возвращает "Driver Error" при обнаружении аппаратной ошибки.
- Максимальный номер точки - 9 (всего 10 точек, нумерация с 0).
- После изменения настроек рекомендуется сохранять их во флэш-память с помощью команды 11.